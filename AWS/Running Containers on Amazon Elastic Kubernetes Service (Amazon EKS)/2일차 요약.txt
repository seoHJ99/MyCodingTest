대규모 관리

수평 확장 : 포드 수 확장 축소
수직 확장(Vertical Pod Autoscaler) : 포드의 리소스 확장 축소
    - 1000m 의 리소스 자원을 할당받았는데 실제로는 200m 만 사용하는 포드의 경우, 800m 가 낭비됨.
    - 따라서 200m 쓰도록 포드를 최적화시키면 800m 의 여유가 생김
    - admission, recommender, updater 가 이 작업을 수행
    - VPA 는 끄기, 초기, 자동으로 설정 가능

클러스터 오토스케일(노드 오토스케일) : 노드 수 확장 축소
반응 속도가 느림
정적인 변화. 변동이 작은 경우

Karpenter : 노드 수 확장 축소 도구
AWS 에서 관리하는 오픈소스 Cluster Autoscaler
적정 규모의 노드로 쿠버네티스 클러스터의 크기를 자동으로 조정
오토 스케일링 그룹을 사용하지 않음
동적인 변화. 변동이 큰 경우.

--------------------------------------------------------
EKS 의 지속적 배포
파이프라인을 구축하여 이미지(컨테이너) 와 리소스를 한번에 관리 필요.
gitOps 는 기존 설정을 유지하는 기능이 있음. 즉, 노드가 추가되거나 삭제되더라도, 원래 설정으로 복구.



------------------------------------------------------
EKS 내의 네트워킹

vpc CNI
Container Networking Interface 의 약자
네트워크 세분화 및 테넌트 격리 구현
네트워크 인바운드 및 아웃바운드 규칙 생성.
zero-trust 네트워크 보안 모델 채택. 누구도 믿지 않고, 매번 보안 확인 필요.
pod 또는 쿠버네티스 네임스페이스에 네트워크 정책 할당

네트워크 보안 정책 spec 에 아무것도 안적혀 있으면 통신 불가.

Lable : 쿠버네티스의 구분 개념. 일종의 태그처럼 사용. 이를 이용해 해당하는 포드만 선택 가능

pod 용 보안그룹
특정 pod 만 aws 리소스에 접근 가능하도록 하는 보안그룹
같은 노드내에 있는 모든 포드가 리소스에 접근하지 않도록 하기 위해 만듬.

서비스를 이용한 로드 밸런싱
서비스 유형
1. ClusterIP : 서비스의 유형. 특정 조건에 해당하는(ex: 이름) 모든 포드들과 연결되며, 해당 포드들의 ip 역할을 대신함.
    - 오직 클러스터 내부에서만 사용
    - 클러스터 내부에서 지정
    - 현재 노드가 아닌 다른 노드의 포트로 보낼수도 있음.
2. NodePort : 노드 내부에서 여는 포트. 
    - 외부 트래픽을 포트를 기준으로 분리하거나, clusterIP 를 통해 들어온 트래픽을 다시 한번 분류하여 노드 포트와 연결된 노드로 보낸다.
    - 자동으로 클러스터 ip 가 생성됨
    - 외부에서 바로 액세스 가능
3. LoadBalancer : 노드 포트와 ClusterIP 까지 생성됨.
    - 외부에서 바로 액세스 가능.
    - 인스턴스 모드와 ip 모드로 나뉨
    - ip 모드 : 노드 포트를 거치지 않고 바로 포드와 통신. Fargate에 사용. 
    - 인스턴스 모드 : 노드 포트와 clusterIP 를 거쳐서 포드와 통신.
4. ExteranlName : 일종의 DNS 같은 역할을 함.
    - 클러스터 외부의 리소스에 연결
     


Ingress : 쿠버네티스 객체. 일종의 ALB 역할을 해주는 개념. url path 에 따라 옳바른 포드의 서비스로 트래픽을 보냄.
    - 생성시 노드 포트, ClusterIp 자동 생성.
    - path 필드에 path 와 서비스의 노드 포트를 생성.


-------------------------------------------------------
EKS 의 관찰 기능

관찰 가능성
지표, 로깅, 추적으로 구성

지표
Prometheus (프로메테우스) : 쿠버네티스가 생성하는 지표 형식을 보기위한 오픈 소스 도구.
PromQL : 지표를 쿼리를 통해 시각화하는 식을 생성.
Grafana : 데이터를 시각화하기 위한 도구.

로그
Fluent Bit : 지표 수집 도구. 노드 내부의 로그를 수집하는 소프트웨어. CloudWatch agent 대신 사용 가능.
FireLens : Fargate 의 지표 수집 도구. Fluent Bit 과 동일한 역할.
기본적으로 EKS 내에서 제어영역 로깅은 비활성 상태.
로깅 워크플로 : 로그 수집 및 전달 -> 로그 집계 및 저장 -> 데이터 시각화

추적
ADOT 를 사용하여 추적
